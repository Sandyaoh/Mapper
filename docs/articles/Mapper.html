<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the Mapper Package • Mapper</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the Mapper Package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Mapper</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Package under development">0.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Mapper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/UsingCustomCover.html">Using a custom covering method</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using the Mapper Package</h1>
                        <h4 class="author">Matt Piekenbrock</h4>
            
      
      
      <div class="hidden name"><code>Mapper.Rmd</code></div>

    </div>

    
    
<p>This document contains a quick overview of how to use the interface in the <em>Mapper</em> package to fully customize the <em>mapper</em> construction. The focus on this document is on package functionality and usage, as opposed the theory the <em>Mapper</em> framework was founded on, and as such discusses <em>Mapper</em> from a strictly algorithmic or computational perspective.</p>
<div id="quickstart" class="section level1">
<h1 class="hasAnchor">
<a href="#quickstart" class="anchor"></a>Quickstart</h1>
<p>Consider a noisy sampling of points along the perimeter of a circle in <span class="math inline">\(\mathbb{R}^2\)</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">## Generate noisy points around the perimeter of a circle </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">n &lt;-<span class="st"> </span><span class="dv">1500</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">t &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">r &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n, <span class="dt">min =</span> <span class="dv">2</span>, <span class="dt">max =</span> <span class="fl">2.1</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">noisy_circle &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(r<span class="op">*</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Trig">cos</a></span>(t), r<span class="op">*</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Trig">sin</a></span>(t))</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">## Plot the circle</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(noisy_circle, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">xlab =</span> <span class="st">"X"</span>, <span class="dt">ylab =</span> <span class="st">"Y"</span>, <span class="dt">main =</span> <span class="st">"Circle"</span>)</a></code></pre></div>
<p><img src="Mapper_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>To get the <strong>mapper</strong> of this circle, first supply the data via <code>X</code> and the mapped values via <code>filter_values</code>, along with the parameters to other components such as the cover and clustering parameters. See <code><a href="../reference/Mapper.html">?mapper</a></code> for more details. A summary is available with the default print method.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"Mapper"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">left_pt &lt;-<span class="st"> </span>noisy_circle[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which.min">which.min</a></span>(noisy_circle[, <span class="dv">1</span>]),]</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">f_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(noisy_circle, <span class="dv">1</span>, <span class="cf">function</span>(pt) (pt <span class="op">-</span><span class="st"> </span>left_pt)[<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">m &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Mapper.html">mapper</a></span>(<span class="dt">X =</span> noisy_circle, <span class="dt">filter_values =</span> f_x, </a>
<a class="sourceLine" id="cb2-5" data-line-number="5">            <span class="dt">cover_params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">typename=</span><span class="st">"restrained rectangular"</span>, </a>
<a class="sourceLine" id="cb2-6" data-line-number="6">                                <span class="dt">number_intervals=</span>10L, <span class="dt">percent_overlap=</span><span class="dv">50</span>),</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">            <span class="dt">measure =</span> <span class="st">"euclidean"</span>, </a>
<a class="sourceLine" id="cb2-8" data-line-number="8">            <span class="dt">cluster_params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">cl=</span><span class="st">"single"</span>, <span class="dt">num_bins=</span>10L))</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(m)</a></code></pre></div>
<pre><code>## Mapper with filter f: X^2 -&gt; Z
## Configured with a Restrained Rectangular cover comprising 10 open sets
## The graph contains 18 vertices and 18 edges</code></pre>
<p>By default, the core information of the <span class="math inline">\(1\)</span>-skeleton of the <code>Mapper</code> construction is returned, including:</p>
<ol style="list-style-type: decimal">
<li><p>The vertices of the graph containing the indices of the points resulting from the clustering.</p></li>
<li><p>An adjacency representation of the mapper graph.</p></li>
<li><p>A list mapping cover indices to vertex ids</p></li>
</ol>
<p>This is, in essence, all the central information one needs to conduct a more in-depth analysis of the mapper.</p>
</div>
<div id="interactively-building-the-mapper" class="section level1">
<h1 class="hasAnchor">
<a href="#interactively-building-the-mapper" class="anchor"></a>Interactively building the Mapper</h1>
<p>For most use-cases, the static method above is sufficient for getting a compact Mapper construction back. However, building the ‘right’ Mapper is usually an interactive process that requires parameter tuning, e.g. trying alternative filter functions, tweaking clustering parameters, exploring different covering strategies, etc. For large data sets, employing this iterative fitting process with the above method can be prohibitively expensive.</p>
<p>To help facilitate this process, the <em>Mapper</em> package uses <code>R6</code> class generators to decompose the components used to build the mapper. A few of the benefits <code>R6</code> classes include full encapsulation support, reference semantics for member fields, easy-to-employ parameter checking via active bindings, and modularity via <a href="https://adv-r.hadley.nz/R6.html#method-chaining">method chaining</a>. More details available at <a href="https://adv-r.hadley.nz/r6.html#introduction-12">Hadleys Advanced R</a> series or the <a href="https://r6.r-lib.org/articles/Introduction.html">R6 documentation site</a>.</p>
<p>To demonstrate some of these benefits, consider a simplified interpretation of the Mapper pipeline:</p>
<ol style="list-style-type: decimal">
<li><p>“Filter” the data via a reference map</p></li>
<li><p>Equip the filter space with a cover</p></li>
<li><p>Construct the <em>k</em>-skeleton</p></li>
</ol>
<p>These steps are demonstrated below using the <code>noisy_circle</code> data set below.</p>
<p>Below is an example of a very simple filter that calculates distance from every points first coordinate to the point with left-most coordinate, <span class="math inline">\(p\)</span>, i.e.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">## 1. Specify a filter function for the data </span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">left_pt &lt;-<span class="st"> </span>noisy_circle[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which.min">which.min</a></span>(noisy_circle[, <span class="dv">1</span>]),]</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">f_x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(noisy_circle, <span class="dv">1</span>, <span class="cf">function</span>(pt) (pt <span class="op">-</span><span class="st"> </span>left_pt)[<span class="dv">1</span>]))</a></code></pre></div>
<p>Coloring the points on a rainbow gradient based on their distance values sheds light on what the filter geometrically represents</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">## Bin the data onto a sufficiently high-resolution rainbow gradient from blue (low) to red (high)</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">rbw_pal &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rev">rev</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/palettes">rainbow</a></span>(<span class="dv">100</span>, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">end =</span> <span class="dv">4</span><span class="op">/</span><span class="dv">6</span>))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">binned_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cut">cut</a></span>(f_x, <span class="dt">breaks =</span> <span class="dv">100</span>, <span class="dt">labels =</span> F)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(noisy_circle, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">col =</span> rbw_pal[binned_idx], <span class="dt">xlab =</span> <span class="st">"X"</span>, <span class="dt">ylab =</span> <span class="st">"Y"</span>, <span class="dt">main =</span> <span class="st">"Circle"</span>)</a></code></pre></div>
<p><img src="Mapper_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>To begin building a mapper object more fluidly, one starts by using the <code>MapperRef</code> R6 class generator. It accepts as its only argument the data matrix, which is stored as read-only field.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">m &lt;-<span class="st"> </span>MapperRef<span class="op">$</span><span class="kw">new</span>(<span class="dt">X =</span> noisy_circle)</a></code></pre></div>
<div id="building-the-cover" class="section level2">
<h2 class="hasAnchor">
<a href="#building-the-cover" class="anchor"></a>Building the cover</h2>
<p>Once the filter has been applied, a cover must be chosen to discretize the space. Here, a simple rectangular cover with fixed centers is used.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">## 2. Create cover of the filter space</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">rec_cover &lt;-<span class="st"> </span>FixedRectangularCover<span class="op">$</span><span class="kw">new</span>(<span class="dt">filter_values =</span> f_x)</a></code></pre></div>
<p>The only required argument is the filter point values themselves; cover-specific parameters may optionally be supplied at initialization, or set via the assignment operator.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">rec_cover<span class="op">$</span>number_intervals &lt;-<span class="st"> </span>5L</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">rec_cover<span class="op">$</span>percent_overlap &lt;-<span class="st"> </span><span class="dv">20</span></a></code></pre></div>
<p>If you supply a single value when the filter dimensionality <span class="math inline">\(&gt; 1\)</span>, the argument is recycled across the dimensions. The cover summary can be printed as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(rec_cover)</a></code></pre></div>
<pre><code>## Cover: (typename = Fixed Rectangular, number intervals = [5], percent overlap = [20]%)</code></pre>
<p>Once parameterized, the cover may be explicitly constructed via the <code>construct_cover</code> member, before sending to Mapper. The <code>construct_cover</code> function uses the given set of parameters to populate the intersection between the open sets in the cover and the given filter data.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">rec_cover<span class="op">$</span><span class="kw">construct_cover</span>() <span class="co">## Now the level sets are populated</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">m<span class="op">$</span>cover &lt;-<span class="st"> </span>rec_cover</a></code></pre></div>
<p><code>Mapper</code> accepts any cover that derives from the abstract <code>CoverRef</code> R6 class. To see a list of the <code>covers_available</code> method.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">## Print the typename/identifer, the R6 generator, and the parameter names</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">Mapper<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/Mapper/topics/covers_available">covers_available</a></span>()</a></code></pre></div>
<pre><code>## Typename:                    Generator:                         Parameters:                          
##  fixed rectangular            FixedRectangularCover              number_intervals, percent_overlap
##  restrained rectangular       RestrainedRectangularCover         number_intervals, percent_overlap
##  adaptive                     AdaptiveCover                      number_intervals, percent_overlap, quantile_method
##  ball                         BallCover                          epsilon</code></pre>
<p>If you want to use a cover outside of the ones offers by the package, feel free to derive a new type cover class (and consider submitting a pull request!).</p>
</div>
<div id="building-the-0-skeleton" class="section level2">
<h2 class="hasAnchor">
<a href="#building-the-0-skeleton" class="anchor"></a>Building the 0-skeleton</h2>
<p>The final step to create a Mapper is to construct the <em>k</em>-skeleton, which requires a different set of procedures, based on <em>k</em>. Since the definition of a <em>k</em>-skeleton is inductive, the <span class="math inline">\(0\)</span>-skeleton is constructed first. This amounts to applying a partial clustering over data intersecting the preimages of the sets comprising the cover. The choice of clustering algorithm, metric, hyper-parameters, etc. is completely customizable–the only requirement is that the [clustering] function take as input at least the data <code>X</code> and a vector of indices <code>idx</code><span class="math inline">\(\subset \{1, 2, \dots, n\}\)</span> and return an integer vector giving a partitioning on that subset.</p>
<p>An example of how one might construct a custom clustering function using the <code>parallelDist</code> and <code>fastcluster</code> packages is given below, wherein the <em>single linkage criterion</em> is used to build a cluster hierarchy, and then a histogram-based heuristic similar the idea discussed in Section 3.1 of the original Mapper paper is used to set the <a href="?stats::cutree">cut value</a>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">custom_clustering_f &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  dependencies_met &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"parallelDist"</span>, <span class="st">"fastcluster"</span>), requireNamespace)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stopifnot">stopifnot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all">all</a></span>(dependencies_met))</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="cf">function</span>(X, idx) {</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    dist_x &lt;-<span class="st"> </span>parallelDist<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/parallelDist/topics/parDist">parallelDist</a></span>(X[idx,], <span class="dt">method =</span> <span class="st">"euclidean"</span>)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    hcl &lt;-<span class="st"> </span>fastcluster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/fastcluster/topics/hclust">hclust</a></span>(dist_x, <span class="dt">method =</span> <span class="st">"single"</span>)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    <span class="kw"><a href="../reference/cutoff_first_bin.html">cutoff_first_bin</a></span>(hcl, <span class="dt">num_bins =</span> 10L)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">  })</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">m<span class="op">$</span>clustering_algorithm &lt;-<span class="st"> </span><span class="kw">custom_clustering_f</span>()</a></code></pre></div>
<p>The clustering function in this example was created as a closure. This can be useful to e.g. store auxiliary parameters option needed by the algorithm, check for package dependencies (like above), cache precomputed information, etc. Since closures <a href="http://adv-r.had.co.nz/Functional-programming.html#functional-programming">capture their enclosing environments</a>, which is a common cause of a form of <a href="http://adv-r.had.co.nz/memory.html#gc">memory leaking</a>, they must be used with caution.</p>
<p>If the clustering function depends on internal components of the <code>MapperRef</code> class instance, the function will error when it is first called. Consider the exact same code as above, but this time parameterized by a field of the <code>MapperRef</code> instance.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">m<span class="op">$</span>measure &lt;-<span class="st"> "euclidean"</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">custom_clustering_f &lt;-<span class="st"> </span><span class="cf">function</span>(){ </a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  ...</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  dist_x &lt;-<span class="st"> </span>parallelDist<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/parallelDist/topics/parDist">parallelDist</a></span>(X[idx,], <span class="dt">method =</span> self<span class="op">$</span>measure)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">  ...</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">}</a></code></pre></div>
<p>This will return an evaluation error upon executing, both from the user side and internally.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">m<span class="op">$</span><span class="kw">clustering_algorithm</span>(<span class="dt">X =</span> noisy_circle, <span class="dt">idx =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">## Error in pmatch(method, METHODS) : object 'self' not found </span></a></code></pre></div>
<p>The search path of the execution environment of the closure doesn’t traverse the binding environment of either the <em>self</em> or <em>private</em> environments associated with the instance. If access to these environments is needed, pass the clustering function via the <code>cl</code> argument of the <code>use_clustering_algorithm</code> member.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">custom_clustering_f &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">linkage=</span><span class="st">"single"</span>, <span class="dt">nbins =</span> 10L){</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="cf">function</span>(X, idx) {</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">    dist_x &lt;-<span class="st"> </span>parallelDist<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/parallelDist/topics/parDist">parallelDist</a></span>(X[idx,], <span class="dt">method =</span> self<span class="op">$</span>measure)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    hcl &lt;-<span class="st"> </span>fastcluster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/fastcluster/topics/hclust">hclust</a></span>(dist_x, <span class="dt">method =</span> linkage)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">    <span class="kw"><a href="../reference/cutoff_first_bin.html">cutoff_first_bin</a></span>(hcl, <span class="dt">num_bins =</span> nbins)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  })</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">m<span class="op">$</span><span class="kw"><a href="../reference/use_clustering_algorithm.html">use_clustering_algorithm</a></span>(<span class="dt">cl =</span> <span class="kw">custom_clustering_f</span>())</a></code></pre></div>
<p>This effectively allows the user to use any clustering algorithm they wish, even algorithms that depend on the internal parameters of the <em>mapper</em> itself.</p>
<p>Alternatively, for people do not have much experience in clustering, the <code>cl</code> argument to <code>use_clustering_algorithm</code> can also be one of the widely-supported linkage criteria and distance measures used in hierarchical clustering, to which a default cutting heuristic is assumed. The distance measure may also be any 1 of the 49 (at this time of writing) proximity measures widely available in from the <code>proxy</code> package.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">m<span class="op">$</span><span class="kw">use_distance_measure</span>(<span class="dt">measure =</span> <span class="st">"euclidean"</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">m<span class="op">$</span><span class="kw"><a href="../reference/use_clustering_algorithm.html">use_clustering_algorithm</a></span>(<span class="dt">cl =</span> <span class="st">"single"</span>)</a></code></pre></div>
<p>For a complete list of the available linkage criteria and distance/similarity measures, see <code><a href="https://www.rdocumentation.org/packages/stats/topics/hclust">?stats::hclust</a></code> and <code><a href="https://www.rdocumentation.org/packages/proxy/topics/registry">?proxy::pr_DB</a></code>, respectively.</p>
<p>Once these have been set, the <span class="math inline">\(0\)</span>-skeleton is computed with the <code>compute_vertices</code> function. <!-- All parameters passed to `compute_vertices` are passed via `...` as hyper-parameters to the clustering algorithm.  --></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">m<span class="op">$</span><span class="kw"><a href="../reference/compute_vertices.html">compute_vertices</a></span>()</a></code></pre></div>
<p>The parameters of these functions may be fine-tuned to allow adjusting only specific parts of the skeleton at a time.</p>
</div>
<div id="building-the-k-skeletons" class="section level2">
<h2 class="hasAnchor">
<a href="#building-the-k-skeletons" class="anchor"></a>Building the k-skeletons</h2>
<p>The <span class="math inline">\(1\)</span>-skeleton is computed analogously.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">m<span class="op">$</span><span class="kw"><a href="../reference/compute_edges.html">compute_edges</a></span>()</a></code></pre></div>
<p>Generally, this is sufficient. However, if the user wishes too, the <span class="math inline">\(k\)</span>-skeleton for any <span class="math inline">\(k &gt; 1\)</span> can also be computed.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">max_k &lt;-<span class="st"> </span>1L</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">m<span class="op">$</span><span class="kw"><a href="../reference/compute_k_skeleton.html">compute_k_skeleton</a></span>(<span class="dt">k =</span> max_k) <span class="co">## higher values of k can be passed as well</span></a></code></pre></div>
<p>The output of Mapper is a simplicial complex, or in the simplest case (when <span class="math inline">\(k = 1\)</span>), a topological graph. Internally, the complex is stored in a <a href="https://hal.inria.fr/hal-00707901v1/document">Simplex Tree</a>. The underlying simplex tree is exported as an <a href="https://cran.r-project.org/web/packages/Rcpp/vignettes/Rcpp-modules.pdf">Rcpp Module</a>, and is accessible via the <code>$simplicial_complex</code> member.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">m<span class="op">$</span>simplicial_complex</a></code></pre></div>
<pre><code>## Simplex Tree with (8, 8) (0, 1)-simplices</code></pre>
<p>The simplex tree is a type of trie specialized specifically for storing and running general algorithms on simplicial complexes. The trie structure can be printed as follows:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">m<span class="op">$</span>simplicial_complex<span class="op">$</span><span class="kw">print_tree</span>()</a></code></pre></div>
<pre><code>## 0 (h = 1): .( 1 2 )
## 1 (h = 1): .( 4 )
## 2 (h = 1): .( 3 )
## 3 (h = 1): .( 6 )
## 4 (h = 1): .( 5 )
## 5 (h = 1): .( 7 )
## 6 (h = 1): .( 7 )
## 7 (h = 0):</code></pre>
</div>
<div id="putting-it-all-together" class="section level2">
<h2 class="hasAnchor">
<a href="#putting-it-all-together" class="anchor"></a>Putting it all together</h2>
<p>The above is a brief exposition into how to customize each component of the Mapper process. All the methods can chained together with the <code>use_*</code> series of members, which all enact side-effects and return the instance invisibly.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co">## Equivalent to all of the above </span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">m &lt;-<span class="st"> </span>MapperRef<span class="op">$</span><span class="kw">new</span>(noisy_circle)<span class="op">$</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/use_cover.html">use_cover</a></span>(<span class="dt">filter_values =</span> f_x, <span class="dt">type =</span> <span class="st">"fixed rectangular"</span>, </a>
<a class="sourceLine" id="cb26-4" data-line-number="4">            <span class="dt">number_intervals =</span> 5L, <span class="dt">percent_overlap =</span> <span class="dv">20</span>)<span class="op">$</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="st">  </span><span class="kw">use_distance_measure</span>(<span class="dt">measure =</span> <span class="st">"euclidean"</span>)<span class="op">$</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/use_clustering_algorithm.html">use_clustering_algorithm</a></span>(<span class="dt">cl =</span> <span class="st">"single"</span>, <span class="dt">num_bins =</span> <span class="dv">10</span>)<span class="op">$</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/compute_k_skeleton.html">compute_k_skeleton</a></span>(<span class="dt">k=</span>1L)</a></code></pre></div>
<p>If the Mapper is constantly being reparameterized, this interface is preferred over the more functional-style <code>mapper</code> call because of the efficiency that comes with mutability. For example, say you wanted to use a different metric for the partial clustering. To change the metric with the static approach, one might do something like the following:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">all_params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">  <span class="dt">X =</span> noisy_circle, <span class="dt">filter_values =</span> f_x, </a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  <span class="dt">cover_params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">typename=</span><span class="st">"restrained rectangular"</span>, </a>
<a class="sourceLine" id="cb27-4" data-line-number="4">                      <span class="dt">number_intervals=</span>10L, <span class="dt">percent_overlap=</span><span class="dv">50</span>), </a>
<a class="sourceLine" id="cb27-5" data-line-number="5">  <span class="dt">cluster_params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">cl=</span><span class="st">"single"</span>, <span class="dt">num_bins=</span>10L)</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"></a>
<a class="sourceLine" id="cb27-8" data-line-number="8">m_static1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(mapper, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/append">append</a></span>(all_params, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>( <span class="dt">measure =</span> <span class="st">"euclidean"</span>)))</a>
<a class="sourceLine" id="cb27-9" data-line-number="9">m_static2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/do.call">do.call</a></span>(mapper, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/append">append</a></span>(all_params, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>( <span class="dt">measure =</span> <span class="st">"mahalanobis"</span>)))</a></code></pre></div>
<p>Both function calls require the entire mapper to be reconstructed, including the cover, the allocation for the simplex tree, all initializers, etc. With reference semantics, you can keep all the same settings and just change what is needed. For example, the following switches the metric to use without reconstructing the cover:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">m_dynamic &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"euclidean"</span>, <span class="st">"mahalanobis"</span>), <span class="cf">function</span>(metric){</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">  m<span class="op">$</span><span class="kw">use_distance_measure</span>(metric)<span class="op">$</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/compute_k_skeleton.html">compute_k_skeleton</a></span>(<span class="dt">k=</span>1L)<span class="op">$</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="../reference/exportMapper.html">exportMapper</a></span>()</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">})</a></code></pre></div>
<p>Due to the a natural dependency chain that comes with Mapper, the simplicial complex had to be recomputed in this case. What requires recomputing depends on how far up the dependency chain you go. For example, consider recomputing the 1-simplices with different intersection size thresholds.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/invisible">invisible</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="cf">function</span>(e_weight){</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">  m<span class="op">$</span><span class="kw"><a href="../reference/compute_edges.html">compute_edges</a></span>(<span class="dt">min_weight =</span> e_weight)<span class="op">$</span><span class="kw"><a href="../reference/exportMapper.html">exportMapper</a></span>()</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">}))</a></code></pre></div>
<p>In this case, compared to the static method, we save on having to recompute the cover, the clustering, and the construction of the vertices.</p>
</div>
<div id="visualizing-the-mapper" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-the-mapper" class="anchor"></a>Visualizing the Mapper</h2>
<p>The <code>grapher</code> package provides a <a href="https://www.htmlwidgets.org/">htmlwidget</a> implementation of Ayasdi’s Apache-licensed <a href="https://github.com/ayasdi/grapher">grapher</a> library, which can be used to visualize the Mapper network, with options to support nice things like <a href="https://github.com/d3/d3-force">D3 force</a>. The <code>$as_grapher</code> function provides a few default coloring and sizing options.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"grapher"</span>)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">m<span class="op">$</span><span class="kw"><a href="../reference/as_grapher.html">as_grapher</a></span>()</a></code></pre></div>
<p>To customize the visualization, refer to graphers <a href="">documentation</a>.</p>
</div>
<div id="accessing-other-members" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-other-members" class="anchor"></a>Accessing other members</h2>
<p>The full help pages for are accessible via the <code><a href="../reference/MapperRef.html">?MapperRef</a></code> page or the additional reference pages on the documentation website.</p>
<p>Below is a brief summary:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(m<span class="op">$</span>cover<span class="op">$</span>filter_values)          <span class="co">## filter values used to build the cover </span></a></code></pre></div>
<pre><code>##  num [1:1500, 1] 3.644 0.615 0.51 0.611 3.439 ...</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(m<span class="op">$</span>cover<span class="op">$</span>index_set)              <span class="co">## index set of the cover </span></a></code></pre></div>
<pre><code>##  chr [1:5] "(1)" "(2)" "(3)" "(4)" "(5)"</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(m<span class="op">$</span>cover<span class="op">$</span>level_sets)             <span class="co">## level set point memberships</span></a></code></pre></div>
<pre><code>## List of 5
##  $ (1): int [1:459] 2 3 4 6 10 12 27 31 34 41 ...
##   ..- attr(*, "bounds")= num [1:2] -0.105 0.944
##  $ (2): int [1:269] 6 9 11 13 15 17 21 22 33 42 ...
##   ..- attr(*, "bounds")= num [1:2] 0.734 1.782
##  $ (3): int [1:234] 8 13 17 18 20 25 32 36 38 49 ...
##   ..- attr(*, "bounds")= num [1:2] 1.57 2.62
##  $ (4): int [1:258] 5 16 19 23 25 26 29 35 37 40 ...
##   ..- attr(*, "bounds")= num [1:2] 2.41 3.46
##  $ (5): int [1:456] 1 5 7 14 24 28 30 39 51 55 ...
##   ..- attr(*, "bounds")= num [1:2] 3.25 4.3</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/args">args</a></span>(m<span class="op">$</span>clustering_algorithm))   <span class="co">## function used to perform the partial clustering </span></a></code></pre></div>
<pre><code>## function (X, idx, num_bins = num_bins.default)</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#quickstart">Quickstart</a></li>
      <li>
<a href="#interactively-building-the-mapper">Interactively building the Mapper</a><ul class="nav nav-pills nav-stacked">
<li><a href="#building-the-cover">Building the cover</a></li>
      <li><a href="#building-the-0-skeleton">Building the 0-skeleton</a></li>
      <li><a href="#building-the-k-skeletons">Building the k-skeletons</a></li>
      <li><a href="#putting-it-all-together">Putting it all together</a></li>
      <li><a href="#visualizing-the-mapper">Visualizing the Mapper</a></li>
      <li><a href="#accessing-other-members">Accessing other members</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matt Piekenbrock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
