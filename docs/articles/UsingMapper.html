<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the Mapper package • Mapper</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the Mapper package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Mapper</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/UsingMapper.html">Using the Mapper package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="UsingMapper_files/htmlwidgets-1.2.1/htmlwidgets.js"></script><script src="UsingMapper_files/grapher-1.3.2/grapher.min.js"></script><script src="UsingMapper_files/grapher-1.3.2/zoom.min.js"></script><script src="UsingMapper_files/grapher-1.3.2/center.min.js"></script><script src="UsingMapper_files/grapher-1.3.2/target.min.js"></script><script src="UsingMapper_files/grapher-1.3.2/grapher_helpers.js"></script><script src="UsingMapper_files/d3-4.9.1/d3.min.js"></script><script src="UsingMapper_files/lodash-4.17.10/lodash.min.js"></script><script src="UsingMapper_files/grapher-binding-1.0/grapher.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using the Mapper package</h1>
                        <h4 class="author">Matt Piekenbrock</h4>
            
      
      
      <div class="hidden name"><code>UsingMapper.Rmd</code></div>

    </div>

    
    
<p>Consider a noisy sampling along the perimeter of a circle</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Generate noisy points around the perimeter of a circle 
n &lt;-<span class="st"> </span><span class="dv">150</span>
t &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span><span class="kw">runif</span>(n)
r &lt;-<span class="st"> </span><span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="dv">2</span>, <span class="dt">max =</span> <span class="fl">2.1</span>)
circ &lt;-<span class="st"> </span><span class="kw">cbind</span>(r<span class="op">*</span><span class="kw">cos</span>(t), r<span class="op">*</span><span class="kw">sin</span>(t))

## Define filter values equal to the distance from each point to the left-most point in the circle 
left_pt &lt;-<span class="st"> </span>circ[<span class="kw">which.min</span>(circ[, <span class="dv">1</span>]),]
f_x &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">colSums</span>(<span class="kw">apply</span>(circ, <span class="dv">1</span>, <span class="cf">function</span>(pt) (pt <span class="op">-</span><span class="st"> </span>left_pt)<span class="op">^</span><span class="dv">2</span>)))

## Bin the data onto a sufficiently high-resolution rainbow gradient from blue (low) to red (high), 
## and plot the original circle  with these values
rbw_pal &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">rainbow</span>(<span class="dv">100</span>, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">end =</span> <span class="dv">4</span><span class="op">/</span><span class="dv">6</span>))
binned_idx &lt;-<span class="st"> </span><span class="kw">cut</span>(f_x, <span class="dt">breaks =</span> <span class="dv">100</span>, <span class="dt">labels =</span> F)
<span class="kw">plot</span>(circ, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">col =</span> rbw_pal[binned_idx], <span class="dt">xlab =</span> <span class="st">"X"</span>, <span class="dt">ylab =</span> <span class="st">"Y"</span>, <span class="dt">main =</span> <span class="st">"Circle"</span>)</code></pre></div>
<p><img src="UsingMapper_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>To get the mapper of this circle, first supply the data via the <code>X</code> parameter and the filtered values via the <code>filter_values</code> argument, e.g. <code><a href="../reference/mapper.html">mapper(X = circ, filter_values = f_x, ...)</a></code>. <code>Mapper</code> dispatches additional parameters passed in <code>...</code> to other methods to further configure the construction. See <code><a href="../reference/mapper.html">?mapper</a></code> for more details. To use a primitive multidimensional, ‘hyper-rectangular’ cover, supply the <code>number_intervals</code> and <code>overlap</code> parameters. A summary is available with the default print method.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span>Mapper<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/Mapper/topics/mapper">mapper</a></span>(<span class="dt">X =</span> circ, <span class="dt">filter_values =</span> f_x, <span class="dt">number_intervals =</span> <span class="dv">5</span>, <span class="dt">overlap =</span> <span class="fl">0.20</span>)
m</code></pre></div>
<pre><code>## Mapper object with filter function f: X^2 -&gt; Z
## Configured with a fixed rectangular cover comprising 5 open sets
## The 1-skeleton contains 15 nodes and 7 edges
## 
## Call:  Mapper::mapper(X = circ, filter_values = f_x, number_intervals = 5, overlap = 0.2)</code></pre>
<p>By default, the core information of the <span class="math inline">\(1\)</span>-skeleton of the <code>Mapper</code> construction is returned, including: 1. The nodes of the topological graph, and the indices of the points contained within each node. 2. The adjacency matrix of the topological graph. 3. The level sets indexing information, and the indices of the nodes they contain in each level set. This is, generally, all one needs to analyze the Mapper construction.</p>
<p>Internally, Mapper uses <code>ReferenceClasses</code> to efficiently compute the simplicial complex. If more information is required beyond the static construction, the <code>return_reference</code> parameter may be set to <code>TRUE</code> to access the underlying <code>MapperRef</code> object. This is useful in situations where each step of the mapper framework needs fine-tuned, e.g. where the construction is requested under multiple parameter settings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m_ref &lt;-<span class="st"> </span>Mapper<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/Mapper/topics/mapper">mapper</a></span>(<span class="dt">X =</span> circ, <span class="dt">filter_values =</span> f_x, <span class="dt">number_intervals =</span> <span class="dv">5</span>, <span class="dt">overlap =</span> <span class="fl">0.20</span>, <span class="dt">return_reference =</span> <span class="ot">TRUE</span>)
m_ref</code></pre></div>
<pre><code>## Mapper construction for 150 objects
## Cover: (type = Fixed rectangular, number intervals = [5], overlap = [0.2])</code></pre>
<p>There are many internal methods which may be called at any time to reconfigure the Mapper object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>(m_ref)</code></pre></div>
<pre><code>##  [1] "clustering_algorithm"   "computeEdges"          
##  [3] "computeLevelSetDist"    "computeNodes"          
##  [5] "config"                 "cover"                 
##  [7] "G"                      "setClusteringAlgorithm"
##  [9] "setCover"               "show"                  
## [11] "X"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>(m_ref<span class="op">$</span>cover)</code></pre></div>
<pre><code>##  [1] "constructCover"   "filter_values"    "index_set"       
##  [4] "initialize"       "initialize#Cover" "level_sets"      
##  [7] "number_intervals" "overlap"          "setOverlap"      
## [10] "setResolution"    "summary"          "type"            
## [13] "valid_pairs"</code></pre>
<p>Keep in mind that to keep the reference object around, copies of the original data and filter values are stored internally. Thus, the reference object takes up significantly more memory than the bare components.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(<span class="st">"pryr"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## Warning: package 'pryr' was built under R version 3.4.3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pryr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pryr/topics/object_size">object_size</a></span>(m)</code></pre></div>
<pre><code>## 6.02 kB</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pryr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pryr/topics/object_size">object_size</a></span>(m_ref)</code></pre></div>
<pre><code>## 1.28 MB</code></pre>
<p>If the dimensionality is low enough, there’s default methods to plot the network or look at the filter space:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m_ref<span class="op">$</span><span class="kw">plotNetwork</span>()</code></pre></div>
<p><img src="UsingMapper_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m_ref<span class="op">$</span>cover<span class="op">$</span><span class="kw">plotFilterSpace</span>()</code></pre></div>
<p><img src="UsingMapper_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>The Mapper packages provides a <a href="https://github.com/d3/d3-force">force-directed</a> <a href="https://www.htmlwidgets.org/">htmlwidget</a> implementation of Ayasdi’s open source <a href="https://github.com/ayasdi/grapher">grapher</a> library, which can be used to visualize the Mapper network.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"grapher"</span>)
g &lt;-<span class="st"> </span>grapher<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grapher/topics/grapher">grapher</a></span>(m_ref)
g</code></pre></div>
<canvas id="htmlwidget-065c1f961f4526e839ca" class="grapher html-widget" style="width:700px;height:432.632880098888px;"></canvas><script type="application/json" data-for="htmlwidget-065c1f961f4526e839ca">{"x":{"net":{"nodes":[{"x":0.8711,"y":0.8666,"r":12.2634,"color":"#0000FFFF","index":0},{"x":0.3022,"y":0,"r":12.9244,"color":"#00A5FFFF","index":1},{"x":0,"y":0.7079,"r":12.2634,"color":"#00B9FFFF","index":2},{"x":0.354,"y":0.9982,"r":10.9748,"color":"#003EFFFF","index":3},{"x":0.4782,"y":0.0193,"r":13.7114,"color":"#00FFC9FF","index":4},{"x":0.1201,"y":0.822,"r":13.3722,"color":"#00FFDEFF","index":5},{"x":0.6543,"y":0.0773,"r":13.9844,"color":"#0FFF00FF","index":6},{"x":0.3133,"y":0.469,"r":13.8084,"color":"#24FF00FF","index":7},{"x":0.8067,"y":0.1808,"r":14.4095,"color":"#D3FF00FF","index":8},{"x":0.1592,"y":0.3737,"r":13.9844,"color":"#FCFF00FF","index":9},{"x":1,"y":0.6002,"r":15,"color":"#FF0000FF","index":10},{"x":0.0099,"y":0.2805,"r":13.6072,"color":"#FF8600FF","index":11},{"x":0.9337,"y":0.2978,"r":13.09,"color":"#FFA500FF","index":12},{"x":0.6404,"y":0.6448,"r":11.9496,"color":"#FF1500FF","index":13},{"x":0.6175,"y":1,"r":10,"color":"#FF4800FF","index":14}],"links":[{"from":1,"to":4,"color":"#00EDFF"},{"from":2,"to":5,"color":"#00EDFF"},{"from":4,"to":6,"color":"#00FF62"},{"from":6,"to":8,"color":"#6CFF00"},{"from":7,"to":9,"color":"#8BFF00"},{"from":8,"to":12,"color":"#FFED00"},{"from":9,"to":11,"color":"#FFC400"}]},"api":[]},"evals":[],"jsHooks":[]}</script><p>A simple interface class <code>grapher</code> is provided to programmatically interact with the widget. The methods can be printed as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(printr)
<span class="kw">help</span>(<span class="dt">package =</span> <span class="st">"grapher"</span>)</code></pre></div>
<pre><code>##      Information on package 'grapher'
## 
## Description:
## 
## Package:           grapher
## Type:              Package
## Title:             Create interactive network visualizations with
##                    Grapher
## Version:           1.0
## Date:              2018-07-04
## Author:            Matt Piekenbrock
## Maintainer:        Matt Piekenbrock &lt;matt.piekenbrock@gmail.com&gt;
## Description:       Based on the 'grapher.js' library by Ayasdi,
##                    'grapher' provides an extensive API for
##                    visualizing and interacting with
##                    WebGL-accelerated force-directed graphs.
##                    Provides additional support for the 'Mapper'
##                    package.
## Encoding:          UTF-8
## VignetteBuilder:   knitr
## Imports:           htmltools (&gt;= 0.2.6), htmlwidgets (&gt;= 0.6),
##                    jsonlite, magrittr, methods, rmarkdown, shiny,
##                    igraph
## RoxygenNote:       6.0.1
## License:           GPL-v3
## Built:             R 3.4.2; ; 2018-07-19 02:52:29 UTC; unix
## RemoteType:        github
## RemoteHost:        https://api.github.com
## RemoteRepo:        grapher
## RemoteUsername:    peekxc
## RemoteRef:         master
## RemoteSha:         8ffce0976ad26a2d884cb1e316abcb5f1b879c5f
## GithubRepo:        grapher
## GithubUsername:    peekxc
## GithubRef:         master
## GithubSHA1:        8ffce0976ad26a2d884cb1e316abcb5f1b879c5f
## 
## Index:
## 
## %&gt;%                     Chain API calls with an htmlwidget.
## addEdges                Add selected edges.
## getDefaultJsonConfig    Creates a default JSON configuration
## grapher                 Grapher
## groupSingletons         Group singletons.
## logNetwork              Logs the network to the rendering console.
##                         Useful for debugging.
## removeEdges             Remove selected edges.
## removeNodes             Remove selected nodes.
## splitByLabel            Splits nodes by a given labeling
## updateEdgeColor         Update the edge colors.
## updateNetwork           Update the network.
## updateNodeColor         Update the node colors.
## updateNodeSize          Update the node sizes.</code></pre>
<p>The grapher instance is fully shiny-compatible. For larger datasets An interactive dashbaord is included to help analyze the Mapper.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ## Load FICO heloc data set</span>
<span class="co"># fico &lt;- data.table::data.table(readr::read_csv("~/WaCS/TDA/heloc_dataset_v1.csv"))</span>
<span class="co"># normalize &lt;- function(x){ (x - min(x))/(max(x) - min(x)) }</span>
<span class="co"># fico_x &lt;- fico[, -1, with = FALSE]</span>
<span class="co"># fico_x &lt;- apply(as.matrix(fico_x), 2, normalize)</span>
<span class="co"># </span>
<span class="co"># ## Do very basic LDA on Risk Performance</span>
<span class="co"># fico_lda &lt;- MASS::lda(x = fico_x, grouping = fico$RiskPerformance, prior = c(0.50, 0.50)) # everybody deserves an equal chance</span>
<span class="co"># f_x &lt;- as.matrix(fico_x) %*% fico_lda$scaling ## Binary classification == 1D subspace </span>
<span class="co"># fico_m &lt;- Mapper::mapper(fico_x, filter_values = f_x, number_intervals = 50L, overlap = 1/3, return_reference = TRUE)</span>
<span class="co"># Mapper::dashboard(fico_m, X = fico, node_color_f = "default")</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matt Piekenbrock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
