---
title: "Multiscale Benchmarks"
output: html_notebook
---


```{r}

X <- apply(chemdiab[, 1:5], 2, function(x) scale(x, center = FALSE))
#f_x <- apply(chemdiab[, c("ga", "ina", "sspg")], 2, scale)
#f_x <- density(X)$y
f_x <- ks::kde(X,H = diag(5), eval.points = X, verbose = FALSE)$estimate

m <- MapperRef$new(X = X)$
  use_cover(filter_values = matrix(f_x), typename = "fixed rectangular", number_intervals = 4L, percent_overlap = 50)$
  use_distance_measure(measure = "euclidean")
#m$clustering_algorithm <- function(X, idx){ rep(1L, length(idx)) }
m$use_clustering_algorithm(cl = "single", num_bins = 20L)
m$compute_vertices()
m$compute_edges()
# m$compute_k_skeleton(k = 1L)

m$as_grapher(TRUE)

g <- igraph::graph_from_adjacency_matrix(m$simplicial_complex$as_adjacency_matrix(), mode = "undirected", add.colnames = NA)

library(RColorBrewer)
diabetic_colors <- colorRamp(c("red", "white", "green"))(cbind(c(0, 0), c(1, 1)))
diabetic_colors
v_col <- sapply(names(m$vertices), function(vid) mean(as.integer(chemdiab$cc)[m$vertices[[vid]]]))+1

plot(g, vertex.color = palette()[v_col])
?igraph::plot.igraph
m$enable_multiscale()

```

```{r}
library(shiny)
library(ggvis)
library(tourr)
gtour <- function(data, groups) {
  aps <- 2
  fps <- 30
  mat <- rescale(as.matrix(data))
  tour <- new_tour(mat, grand_tour(), NULL)
  start <- tour(0)
  proj_data <- reactive({
    invalidateLater(1000 / fps, NULL);
    step <- tour(aps / fps)
    data.frame(center(mat %*% step$proj), groups = groups)
  })
  proj_data %>% ggvis(~X1, ~X2, fill = ~groups) %>%
    layer_points() %>%
    scale_numeric("x", domain = c(-1, 1)) %>%
    scale_numeric("y", domain = c(-1, 1)) %>%
    add_axis("x", title = "") %>% add_axis("y", title = "") %>%
    set_options(duration = 0)
}
```

```{r echo=FALSE}
# gtour(flea[1:6], flea[[7]])
# gtour(olive[3:10], olive[[1]])
gtour(chemdiab[,1:5], as.integer(chemdiab$cc))
```


```{r}
crater <- as.matrix(readr::read_table(file = "~/Downloads/crater.xy.txt", col_names = FALSE))

```
